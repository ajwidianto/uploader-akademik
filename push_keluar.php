<?php
require 'controller/callApi.php';
require 'controller/DbConfig.php';
require 'util/AkmUtil.php';
require 'helper/feeder_helper.php';

//set limit
set_time_limit(3600);
ini_set('memory_limit', '-1');

//Configurasi
$api = new callApi();
$db = new DbConfig();
$akm_util = new AkmUtil();
$feeder_helper = new FeederHelper();

//getToken
$token = $feeder_helper->get_token_feeder();

$arrNim = array("1101190541",
"1101190543",
"1101200058",
"1101200064",
"1101200194",
"1101200239",
"1101200259",
"1101200372",
"1101200566",
"1101201406",
"1101201475",
"1101201482",
"1101201489",
"1101201509",
"1101201515",
"1101201532",
"1101202001",
"1101202181",
"1101202203",
"1101202215",
"1101202268",
"1101202277",
"1101202330",
"1101202371",
"1101202374",
"1101202379",
"1101202505",
"1101202558",
"1101204004",
"1101204006",
"1101204011",
"1101204018",
"1101204021",
"1101204023",
"1101204024",
"1101204029",
"1101204042",
"1101204044",
"1101204054",
"1101204072",
"1101204075",
"1101204094",
"1101204102",
"1101204123",
"1101204131",
"1101204133",
"1101204140",
"1101204142",
"1101204149",
"1101204204",
"1101204218",
"1101204246",
"1101204257",
"1101204307",
"1101204315",
"1101204341",
"1101204362",
"1101204386",
"1101204388",
"1101204393",
"1101204403",
"1101204429",
"1101204436",
"1101204459",
"1101204470",
"1101228228",
"1101228339",
"1101228423",
"1101228440",
"1101228446",
"1102172213",
"1102184253",
"1102184255",
"1102190279",
"1102200515",
"1102201673",
"1102204441",
"1102204526",
"1102204558",
"1102204600",
"1103192024",
"1103200001",
"1103200004",
"1103200021",
"1103200024",
"1103200025",
"1103200034",
"1103200056",
"1103200066",
"1103200149",
"1103200214",
"1103201049",
"1103201242",
"1103201250",
"1103201253",
"1103201261",
"1103201263",
"1103202004",
"1103202022",
"1103202098",
"1103202121",
"1103202190",
"1103202201",
"1103203227",
"1103204012",
"1103204016",
"1103204030",
"1103204035",
"1103204060",
"1103204074",
"1103204086",
"1103204115",
"1103204137",
"1103204146",
"1103204152",
"1103204159",
"1103204160",
"1103204195",
"1104174116",
"1104180131",
"1104200053",
"1104201101",
"1104201105",
"1104201110",
"1104201124",
"1104201126",
"1104201133",
"1104201138",
"1104202087",
"1104202102",
"1104204026",
"1104204038",
"1104204048",
"1201183438",
"1201184004",
"1201184066",
"1201190328",
"1201190456",
"1201190457",
"1201192011",
"1201192033",
"1201194169",
"1201194204",
"1201200016",
"1201200039",
"1201200044",
"1201200251",
"1201200278",
"1201200310",
"1201200373",
"1201200460",
"1201202004",
"1201202112",
"1201202497",
"1201203260",
"1201203386",
"1201204005",
"1201204027",
"1201204035",
"1201204069",
"1201204119",
"1201204121",
"1201204123",
"1201204127",
"1201204158",
"1201204168",
"1201204188",
"1201204275",
"1201204281",
"1201204368",
"1201204420",
"1201204421",
"1201204440",
"1201204466",
"1202190247",
"1202190396",
"1202192049",
"1202194120",
"1202200010",
"1202200045",
"1202200049",
"1202200067",
"1202200074",
"1202200081",
"1202200091",
"1202200093",
"1202200100",
"1202200127",
"1202200168",
"1202200199",
"1202200271",
"1202200403",
"1202200409",
"1202200415",
"1202201256",
"1202201259",
"1202202061",
"1202202071",
"1202202104",
"1202204006",
"1202204094",
"1202204095",
"1202204108",
"1202204179",
"1202204249",
"1202204274",
"1202204326",
"1202204331",
"1202204363",
"1202208386",
"1203200002",
"1203200006",
"1203200015",
"1203200018",
"1203200020",
"1203200022",
"1203200038",
"1203200046",
"1203200057",
"1203200058",
"1203200061",
"1203200076",
"1203200093",
"1203201050",
"1203201090",
"1203202110",
"1301174016",
"1301194198",
"1301200013",
"1301200128",
"1301201578",
"1301204009",
"1301204064",
"1301204114",
"1301204123",
"1301204125",
"1301204138",
"1301204153",
"1301204192",
"1301204197",
"1301204243",
"1301204267",
"1301204295",
"1301204367",
"1301204368",
"1301204380",
"1301204474",
"1301204526",
"1301218474",
"1301218682",
"1301218691",
"1301218698",
"1302190047",
"1303200041",
"1303200044",
"1303200101",
"1303200125",
"1303201130",
"1303201173",
"1303201174",
"1303201181",
"1303201185",
"1303202045",
"1303202047",
"1303202076",
"1303204008",
"1303204031",
"1303204060",
"1303204100",
"1303204133",
"1303204151",
"1303204154",
"1401170110",
"1401170137",
"1401170518",
"1401171248",
"1401174099",
"1401174121",
"1401174391",
"1401174415",
"1401174548",
"1401182611",
"1401183519",
"1401184182",
"1401184301",
"1401194075",
"1401194078",
"1401194109",
"1401194149",
"1401194162",
"1401194185",
"1401194269",
"1401194308",
"1401194456",
"1401200046",
"1401200050",
"1401200234",
"1401200262",
"1401200265",
"1401200314",
"1401200394",
"1401200415",
"1401200462",
"1401200594",
"1401201007",
"1401201015",
"1401201196",
"1401201222",
"1401201237",
"1401201263",
"1401201597",
"1401201598",
"1401201602",
"1401201603",
"1401201605",
"1401201615",
"1401202092",
"1401202432",
"1401202526",
"1401202591",
"1401203186",
"1401203420",
"1401203537",
"1401203554",
"1401203568",
"1401204002",
"1401204048",
"1401204059",
"1401204067",
"1401204068",
"1401204069",
"1401204080",
"1401204088",
"1401204095",
"1401204109",
"1401204110",
"1401204116",
"1401204121",
"1401204124",
"1401204161",
"1401204166",
"1401204171",
"1401204212",
"1401204227",
"1401204232",
"1401204236",
"1401204245",
"1401204255",
"1401204260",
"1401204270",
"1401204277",
"1401204285",
"1401204287",
"1401204293",
"1401204313",
"1401204322",
"1401204330",
"1401204361",
"1401204370",
"1401204372",
"1401204382",
"1401204408",
"1401204411",
"1401204428",
"1401204434",
"1401204455",
"1401204466",
"1401204509",
"1401204563",
"1402170086",
"1402174191",
"1402182321",
"1402184308",
"1402193106",
"1402193245",
"1402194110",
"1402200055",
"1402200067",
"1402200071",
"1402200072",
"1402200165",
"1402201148",
"1402201358",
"1402201366",
"1402202020",
"1402202105",
"1402202115",
"1402202129",
"1402202149",
"1402202157",
"1402202167",
"1402202201",
"1402202363",
"1402202390",
"1402204015",
"1402204036",
"1402204038",
"1402204043",
"1402204058",
"1402204073",
"1402204087",
"1402204147",
"1402204160",
"1402204168",
"1402204173",
"1402204175",
"1402204194",
"1402204198",
"1501170231",
"1501190029",
"1501190172",
"1501190262",
"1501194061",
"1501200028",
"1501200039",
"1501200053",
"1501200060",
"1501200064",
"1501200065",
"1501200096",
"1501200102",
"1501200112",
"1501200128",
"1501200140",
"1501200169",
"1501200170",
"1501200175",
"1501200177",
"1501200189",
"1501200201",
"1501200210",
"1501200245",
"1501200254",
"1501200290",
"1501200294",
"1501200299",
"1501200300",
"1501200301",
"1501200306",
"1501200320",
"1501200342",
"1501200348",
"1501200351",
"1501200365",
"1501200367",
"1501200371",
"1501200429",
"1501201265",
"1501201433",
"1501201447",
"1501201449",
"1501201455",
"1501202022",
"1501202190",
"1501202222",
"1501202232",
"1501202242",
"1501202243",
"1501202273",
"1501202287",
"1501203374",
"1501203383",
"1501204003",
"1501204008",
"1501204017",
"1501204032",
"1501204035",
"1501204038",
"1501204046",
"1501204067",
"1501204076",
"1501204087",
"1501204094",
"1501204098",
"1501204101",
"1501204111",
"1501204120",
"1501204125",
"1501204126",
"1501204151",
"1501204155",
"1501204163",
"1501204171",
"1501204173",
"1501204178",
"1501204179",
"1501204194",
"1501204202",
"1501204205",
"1501204211",
"1501204237",
"1501204291",
"1501204317",
"1501204325",
"1501204328",
"1501204330",
"1501204364",
"1501204366",
"1501204387",
"1501204398",
"1501204403",
"1501228278",
"1501228415",
"1501228418",
"1502170051",
"1502170164",
"1502193404",
"1502194091",
"1502194134",
"1502194294",
"1502200142",
"1502200178",
"1502200190",
"1502200211",
"1502200242",
"1502200283",
"1502200309",
"1502200312",
"1502200322",
"1502200339",
"1502200377",
"1502200404",
"1502200423",
"1502200490",
"1502201015",
"1502201152",
"1502201261",
"1502201378",
"1502201500",
"1502201504",
"1502201509",
"1502201526",
"1502201527",
"1502201528",
"1502201529",
"1502201532",
"1502201535",
"1502201537",
"1502201538",
"1502201544",
"1502202062",
"1502202109",
"1502202156",
"1502202541",
"1502202551",
"1502202554",
"1502203476",
"1502203545",
"1502204010",
"1502204029",
"1502204038",
"1502204040",
"1502204044",
"1502204045",
"1502204051",
"1502204053",
"1502204058",
"1502204063",
"1502204071",
"1502204082",
"1502204097",
"1502204105",
"1502204111",
"1502204123",
"1502204126",
"1502204133",
"1502204158",
"1502204162",
"1502204163",
"1502204179",
"1502204184",
"1502204203",
"1502204205",
"1502204209",
"1502204212",
"1502204228",
"1502204234",
"1502204235",
"1502204237",
"1502204238",
"1502204245",
"1502204248",
"1502204251",
"1502204252",
"1502204254",
"1502204270",
"1502204276",
"1502204284",
"1502204300",
"1502204303",
"1502204307",
"1502204311",
"1502204323",
"1502204352",
"1502204356",
"1502204362",
"1502204379",
"1502204388",
"1502204389",
"1502204400",
"1502204426",
"1502204436",
"1502204446",
"1502204448",
"1502204465",
"1503200003",
"1503200006",
"1503200008",
"1503200033",
"1503200037",
"1503200039",
"1503200042",
"1503200044",
"1503200055",
"1503200093",
"1503200111",
"1503200112",
"1503200145",
"1503200181",
"1503200197",
"1503200205",
"1503202016",
"1503202020",
"1503202070",
"1503202073",
"1503202088",
"1503202090",
"1503202118",
"1503202133",
"1503202149",
"1503202169",
"1503202199",
"1503202209",
"1503202243",
"1503202244",
"1503203218",
"1503203225",
"1503203233",
"1503204022",
"1503204056",
"1503204062",
"1503204072",
"1503204075",
"1503204100",
"1503204106",
"1503204123",
"1503204148",
"1503204157",
"1503204158",
"1503204170",
"1503204180",
"1503204190",
"1601194325",
"1601200016",
"1601200020",
"1601200038",
"1601200052",
"1601200090",
"1601200155",
"1601200204",
"1601200283",
"1601200339",
"1601200345",
"1601201065",
"1601201487",
"1601202007",
"1601202117",
"1601202338",
"1601202419",
"1601204004",
"1601204059",
"1601204076",
"1601204080",
"1601204085",
"1601204089",
"1601204100",
"1601204120",
"1601204130",
"1601204163",
"1601204208",
"1601204214",
"1601204222",
"1601204239",
"1601204245",
"1601204258",
"1601204342",
"1601204423",
"1601204444",
"1601204451",
"1601204455",
"1601204456",
"1603170236",
"1603174240",
"1603184019",
"1603184066",
"1603184126",
"1603184134",
"1603194119",
"1603200010",
"1603200023",
"1603200031",
"1603200054",
"1603200063",
"1603200095",
"1603201018",
"1603201035",
"1603201232",
"1603202005",
"1603204012",
"1603204015",
"1603204026",
"1603204052",
"1603204055",
"1603204121",
"1603204186",
"1604204002",
"1604204021",
"1604204103",
"205022310021",
"205022310026",
"205022310036",
"205022310054",
"206012310009",
"206012310010",
"206012310011",
"206012310014",
"206012310015",
"206012310021",
"206012310023",
"206012310025",
"206012310026",
"206012310028",
"206012310031",
"206012310032",
"206012310037",
"206012310038",
"206012310039",
"2101221003",
"2101221004",
"2101221015",
"2101221016",
"2101221023",
"2101221030",
"2101221060",
"2101221067",
"2202210026",
"2202212029",
"2202212047",
"2202221040",
"2301192020",
"2301201017",
"2301211007",
"2301221019",
"2401202131",
"2401211008",
"2401211030",
"2401221023",
"2401221024",
"2401221025",
"2401221027",
"2401221041",
"2401221086",
"2403211009",
"2403211066",
"2403212083",
"2403212094",
"2403212105",
"2403212116",
"2403212119",
"2403212138",
"2403212139",
"2403212140",
"2403221038",
"2501221006",
"2501221009",
"2501221012",
"2501221023",
"2501222056",
"2501222059",
"2601200020",
"2601202032",
"2601202035",
"2601202051",
"2601211010",
"2601211013",
"2601212058",
"2601221001",
"2601221002",
"2601221004",
"2601221006",
"2601221008",
"2601221009",
"2601221010",
"2601221013",
"2601221014",
"2601221018",
"2601221020",
"2601221022",
"2601221023",
"2601221025",
"2601221027",
"2601221035",
"2601221038",
"2601221056",
"6701202044",
"6701202088",
"6701210013",
"6701210031",
"6701210036",
"6701210067",
"6701210081",
"6701210090",
"6701210091",
"6701210100",
"6701213004",
"6701213005",
"6701213009",
"6701213011",
"6701213012",
"6701213014",
"6701213015",
"6701213018",
"6701213019",
"6701213022",
"6701213025",
"6701213026",
"6701213027",
"6701213028",
"6701213029",
"6701213030",
"6701213032",
"6701213034",
"6701213035",
"6701213042",
"6701213044",
"6701213048",
"6701213049",
"6701213050",
"6701213051",
"6701213052",
"6701213056",
"6701213058",
"6701213059",
"6701213060",
"6701213061",
"6701213068",
"6701213069",
"6701213071",
"6701213073",
"6701213074",
"6701213077",
"6701213078",
"6701213082",
"6701213086",
"6701213087",
"6701213088",
"6701213099",
"6701213102",
"6701213103",
"6701213106",
"6701213107",
"6701213108",
"6701213111",
"6701213113",
"6702210023",
"6702210025",
"6702210030",
"6702210031",
"6702210045",
"6702213003",
"6702213007",
"6702213009",
"6702213013",
"6702213019",
"6702213027",
"6702213028",
"6702213033",
"6702213040",
"6703193006",
"6703194087",
"6703201120",
"6703202025",
"6703202050",
"6703210040",
"6703210056",
"6703210063",
"6703210066",
"6703210069",
"6703210076",
"6703210079",
"6703213006",
"6703213008",
"6703213010",
"6703213011",
"6703213012",
"6703213016",
"6703213020",
"6703213026",
"6703213031",
"6703213033",
"6703213038",
"6703213042",
"6703213047",
"6703213049",
"6703213067",
"6703213071",
"6703213074",
"6704202021",
"6704204007",
"6704210036",
"6704210039",
"6704210047",
"6704210109",
"6704210117",
"6704210121",
"6704210135",
"6704210162",
"6704213004",
"6704213011",
"6704213024",
"6704213030",
"6704213033",
"6704213045",
"6704213055",
"6704213072",
"6704213077",
"6704213081",
"6704213111",
"6704213120",
"6704213133",
"6705190124",
"6705210001",
"6705210012",
"6705210022",
"6705210037",
"6705210041",
"6705210045",
"6705210046",
"6705210049",
"6705210061",
"6705213003",
"6705213004",
"6705213008",
"6705213009",
"6705213011",
"6705213013",
"6705213015",
"6705213016",
"6705213019",
"6705213021",
"6705213023",
"6705213024",
"6705213025",
"6705213026",
"6705213027",
"6705213029",
"6705213030",
"6705213031",
"6705213032",
"6705213033",
"6705213034",
"6705213039",
"6705213040",
"6705213042",
"6705213043",
"6705213044",
"6705213048",
"6705213050",
"6705213051",
"6705213062",
"6706190006",
"6706190019",
"6706210012",
"6706210043",
"6706210052",
"6706210061",
"6706210067",
"6706210072",
"6706210092",
"6706210097",
"6706210099",
"6706210104",
"6706210114",
"6706210119",
"6706210130",
"6706210147",
"6706210157",
"6706213001",
"6706213002",
"6706213003",
"6706213006",
"6706213007",
"6706213008",
"6706213011",
"6706213016",
"6706213018",
"6706213020",
"6706213021",
"6706213022",
"6706213023",
"6706213025",
"6706213027",
"6706213028",
"6706213029",
"6706213030",
"6706213031",
"6706213032",
"6706213034",
"6706213037",
"6706213038",
"6706213040",
"6706213041",
"6706213044",
"6706213045",
"6706213048",
"6706213049",
"6706213050",
"6706213055",
"6706213056",
"6706213058",
"6706213059",
"6706213060",
"6706213062",
"6706213063",
"6706213064",
"6706213068",
"6706213071",
"6706213073",
"6706213077",
"6706213080",
"6706213083",
"6706213089",
"6706213090",
"6706213094",
"6706213095",
"6706213098",
"6706213100",
"6706213102",
"6706213105",
"6706213107",
"6706213110",
"6706213117",
"6706213118",
"6706213127",
"6706213133",
"6706213134",
"6706213145",
"6706213149",
"6706213152",
"6706213155",
"7708194020"


);

$id_smt = $_GET['id_smt']; //cth:20182(tahun ajaran 2018/2019 semester 2)
$cek_keluar = 0; //0="aktif";1="lulus";2="aktif&lulus";
$aktifcek_undir = 0; //0="aktif";1="undir";2="aktif&undir";
$cek_cuti = 0; //0="aktif";1="cuti";
$cek_mangkir = 0; //0="aktif";1="mangkir";

$sc = substr($id_smt, 2, 2) . "" . (substr($id_smt, 2, 2) + 1); //cth 1819(tahun ajaran 2018 / 2019)
$th = substr($id_smt, 0, 4);
$smt = substr($id_smt, -1, 1);

$row = $_GET['row'];
$pushType = $_GET['push_type'];
$limit = 1;
$nim_push=$arrNim[$row];

if($pushType == "normal"){
	$student = $db->getStudentAKM("(OUTDATE IS NULL OR ID_SMT_LULUS >= ".$id_smt.") AND ID_SMT_MASUK <= ".$id_smt." AND ID_REG_PD IS NOT NULL AND ID_REG_PD NOT LIKE '%Error%'",$row,($row+$limit));
}else if($pushType == "update"){
	//type update all data
	$student = $db->getStudentAKM("(OUTDATE IS NULL OR ID_SMT_LULUS >= ".$id_smt.") AND ID_SMT_MASUK <= ".$id_smt,$row,($row+$limit));
}else if($pushType == "error"){
	$student = $db->getStudentAKM("(OUTDATE IS NULL OR ID_SMT_LULUS >= ".$id_smt.") AND ID_SMT_MASUK <= ".$id_smt." AND ID_REG_PD IS LIKE '%Error%'",$row,($row+$limit));
}else if($pushType == "case"){
	$student = $db->getStudentAKM("STUDENTID  ='".$nim_push."'",1,2);
}else{
	header("HTTP/1.0 404 Not Found");
	echo "<h1>404 - Page Not Found</h1>";
	echo "<p>The page you are looking for does not exist.</p>";
	die();
}

echo "<pre>";
print_r ($student);
echo "</pre>";
//die();

if(!empty($student)){ 
	foreach ($student as $key => $value) {
	$data = (array_change_key_case($value, CASE_LOWER));	 
		//inisialisasi nim students	
		$nim=$data['studentid'];
		
		//Cek Lulus		
		$cek_lulus = $db->CekLulus("STUDENTID='".$nim."' AND SCHOOLYEAR <= ".$sc);
		 echo "<pre>Data Lulus";
	 print_r ($cek_lulus);
	 echo "</pre>";
		// die();
		
		if($data['id_smt_lulus']>=$id_smt or $data['id_smt_lulus']==""){
			// cek lulus			
			if (empty($cek_lulus)) {
				$cek_keluar = 0;
			} else {
				//$cek_lulus_smt = $db->CekLulus("STUDENTID='".$nim."' AND SCHOOLYEAR =".$sc." AND SEMESTER = ".$smt);
				//if (empty($cek_lulus_smt)) {
				//	$cek_keluar = 0;
					
				//	echo $sc."</br>";
				//	echo $smt."</br>";
				//} else {
					$cek_AKM = $db->getKrs("NIPD='".$nim."' AND SCHOOLYEAR = ".$sc." AND SEMESTER = ".$smt,1,2);	
					if (empty($cek_AKM)) {
						$cek_keluar = 1;
						// TODO PUSH LULUS
						echo "PUSH LULUS</br>";
						$akm_util->insertMahasiswaKeluar(1, $nim, $data['id_smt_lulus'], $token, $sc, $smt);
					} else {
						$cek_keluar = 2;					
						//TODO PUSH LULUS & PUSH AKTIF
						//echo "PUSH AKTIF</br>";
						//$akm_util->insertAktivitasKuliahMahasiswa($nim, "A", $token, $id_smt);
						echo "PUSH LULUS</br>";						
						$akm_util->insertMahasiswaKeluar(1, $nim, $data['id_smt_lulus'], $token, $sc, $smt);
					}

				//}
			}


			//Cek DO/Undur diri
			if ($cek_keluar == 0) {
				//Cek_undur_diri
				$cek_DOUndir = $db->CekDo("STUDENTID='".$nim."' AND SCHOOLYEAR <=".$sc);
				if (empty($cek_DOUndir)) {
					$cek_undir = 0;
				} else {
					$cek_DOUndir_smt = $db->CekDo("STUDENTID='".$nim."' AND SCHOOLYEAR ='".$sc."' AND SEMESTER = ".$smt);
					if (empty($cek_DOUndir_smt)) {
						$cek_undir = 0;
					} else {
						$cek_AKM = $db->getKrs("NIPD='".$nim."' AND SCHOOLYEAR = ".$sc." AND SEMESTER = ".$smt,1,2);
						if (empty($cek_AKM)) {
							$cek_undir = 1;
							//TODO PUSH UNDIR
							// TODO CEK NON-AKTIF
							// CEK SKIP REGISTRATION
							if(!empty($skipRegistration)){
								//push non aktif
								echo "PUSH DO/UNDIR</br>";
								$akm_util->insertMahasiswaKeluar(4, $nim, $data['id_smt_lulus'], $token, $sc, $smt);
							}
						} else {
							$cek_undir = 2;
							//TODO PUSH UNDIR & PUSH AKTIF
							echo "PUSH DO/UNDIR & AKTIF</br>";	
							//$akm_util->insertAktivitasKuliahMahasiswa($nim, "A", $token, $id_smt);
							$akm_util->insertMahasiswaKeluar(4, $nim, $data['id_smt_lulus'], $token, $sc, $smt);	
						}

					}
				}
			}

			//Cek_cuti
			/*if ($cek_keluar == 0 && $cek_undir == 0) {
				$cek_CutiMhs_smt = $db->getLeave("STUDENTID='".$nim."' AND STARTLEAVESCHOOLYEAR = ".$sc." AND STARTLEAVESEMESTER = ".$smt." AND STATUS_DIRAKAD='Y'",1,2);
				if (empty($cek_CutiMhs_smt)) {
					$cek_cuti = 0;
				} else {
					$cek_cuti = 1;		
					// TODO PUSH CUTI
					echo "PUSH CUTI</br>";
					$akm_util->insertAktivitasKuliahMahasiswa($nim, "C", $token, $id_smt);
				}
			}
*/
            // $cek_meninggal = 0;
			//cek meninggal
			//if($cek_keluar == 0 && $cek_undir == 0 && $cek_cuti == 0){
				//
				// $cek_db_meninggal = $db->cekMeninggal("STUDENTID='".$nim."' AND SCHOOLYEAR <=".$sc);
				// if (empty($cek_db_meninggal)) {
				// 	$cek_meninggal = 0;
				// } else {
				// 	$cek_db_meninggal = $db->cekMeninggal("STUDENTID='".$nim."' AND SCHOOLYEAR ='".$sc."' AND SEMESTER = ".$smt);
				// 	if (empty($cek_db_meninggal)) {
				// 		$cek_meninggal = 0;
				// 	} else {
				// 		$cek_AKM = $db->getKrs("NIPD='".$nim."' AND SCHOOLYEAR = ".$sc." AND SEMESTER = ".$smt,1,2);
				// 		if (empty($cek_AKM)) {
				// 			$cek_meninggal = 1;
				
				//			TODO PUSH MENINGGAL
							// $akm_util->insertMahasiswaKeluar(6, $nim, $data['id_smt_lulus'], $token, $sc, $smt);
				// 			CEK SKIP REGISTRATION

				// 			TODO CEK NON-AKTIF
				//			$cek_mangkirMhs_smt = $db->getMangkirMhs("STUDENTID='".$nim."' AND SKIPSCHOOLYEAR = ".$sc." AND SKIPSEMESTER = ".$smt,1,2);
							// if(!empty(cek_mangkirMhs_smt))
								// $akm_util->insertAktivitasKuliahMahasiswa($nim, "N", $token, $id_smt);
				// 			echo "PUSH MENINGGAL & NON AKTIF</br>";									
				// 		} else {
				// 			$cek_meninggal = 2;
				// 			//TODO MENINGGAL & PUSH AKTIF
				// 			echo "PUSH MENINGGAL & AKTIF</br>";	
				// 			// $akm_util->insertAktivitasKuliahMahasiswa($nim, "A", $token, $id_smt);
				// 			// $akm_util->insertMahasiswaKeluar(6, $nim, $data['id_smt_lulus'], $token, $sc, $smt);	
				// 		}

				// 	}
				// }
			// }
				
			//Cek_mangkir
			if ($cek_keluar == 0 && $cek_undir == 0 && $cek_cuti == 0 && $cek_meninggal == 0) {

				$cek_mangkirMhs_smt = $db->getMangkirMhs("STUDENTID='".$nim."' AND SKIPSCHOOLYEAR = ".$sc." AND SKIPSEMESTER = ".$smt,1,2);
				
				if (empty($cek_mangkirMhs_smt)) {
					$cek_mangkir = 0;
				} else {
					$cek_mangkir = 1;
				}
				
				// echo "cek mangkir1".$cek_mangkir."</br>";
				//Cek_mangkir
				$cek_mangkirMhs_current_smt = $db->getMangkirMhsCurrent("STUDENTID='".$nim."' and SCHOOLYEAR = ".$sc." and SEMESTER = ".$smt." and REGISTRATIONSTEPID = 3",1,2);

					if (!empty($cek_mangkirMhs_current_smt)) {
						$cek_mangkir = 0;
					} else {
						$cek_mangkir = 1;
					}
				
				// echo "cek mangkir2".$cek_mangkir."</br>";
				/*if ($cek_mangkir == 1) {
					//TODO PUSH MANGKIR/ NON-AKTIF;
					echo "PUSH MANGKIR/ NON-AKTIF</br>";					
					$akm_util->insertAktivitasKuliahMahasiswa($nim, "N", $token, $id_smt);	
				}*/
			}

			/*if ($cek_keluar == 0 && $cek_undir == 0 && $cek_cuti == 0 && $cek_meninggal == 0 && $cek_mangkir == 0) {
				//TODO PUSH AKTIF
				echo "PUSH AKTIF</br>";
				// die();
				$resAkm = $akm_util->insertAktivitasKuliahMahasiswa($nim, "A", $token, $id_smt);
				echo "<pre>";
				print_r($resAkm);
				echo "</pre>";
			}*/
		}
		//die();
	}
	echo "PROCESSING...";
}else{
	echo "SELESAI";
	die();
}

header("Refresh: 3; url=push_keluar.php?id_smt=".$_GET['id_smt']."&row=".($row+$limit)."&push_type=".$pushType);
?>